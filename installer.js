// @bun
import d from"os";var c="\x1B[32m",l="\x1B[0m",a="./node_modules/yajsb/lib",r=d.platform().startsWith("win")?"move":"mv";async function o(s,e){try{console.log(e),console.log(s);let t=Bun.spawn(s.split(" "),{stdout:"pipe",stderr:"pipe"}),n=t.stdout?await new Response(t.stdout).text():"",i=t.stderr?await new Response(t.stderr).text():"";if(await t.exited!==0)console.error(`\u274C Command failed: ${s}`),console.error(`stdout: ${n}`),console.error(`stderr: ${i}`),process.exit(1);else{if(console.log(`${c}\u2714 Command succeeded: ${s}${l}`),n.trim())console.log(n.trim());if(i.trim())console.log(i.trim())}}catch(t){console.error("\uD83D\uDEA8 Erreur critique:",t),process.exit(1)}}function u(s){let e=process.stdin;return process.stdout.write(s),new Promise((n)=>{e.resume(),e.once("data",(i)=>{n(i.toString().trim())})})}async function p(){try{await o("bun init","\uD83D\uDCE6 Project instantiation..."),await o("bun add github:fullstackbeaver/yajsb","\uD83D\uDCE6 Installing yasb..."),console.log("\uD83D\uDCE6 Ajout des scripts...");let s=await Bun.file("./package.json").json();s.scripts={...s.scripts,start:"bun --watch run index.ts --verbose",updateComponentsList:"bun run scripts.ts types",updateComponentsScssList:"bun run scripts.ts scss"},await Bun.write("./package.json",JSON.stringify(s,null,2)),await o(`${r} ${a}/scripts.ts ./scripts.ts`,"\uD83D\uDCE6 Adding scripts"),await o(`${r} ${a}/templates ./templates`,"\uD83D\uDCE6 Adding templates..."),console.log(`${c}Do you need a demo site?${l}`),console.log("(1) yes"),console.log("(2) no");let e=await u("Select an option (default is 1): "),t=e===""?1:parseInt(e);if(t>2||t<1)t=1;if(t===1)await o("bun add github:fullstackbeaver/yajsb-site-demo -D","\uD83D\uDCE6 Installation of the sample site..."),await o(`${r} ./node_modules/yajsb-site-demo ./site`,"\uD83D\uDCE6 Moving sample site into project...");else await o("mkdir ./site","\uD83D\uDCE6 Creating site folder...")}catch(s){console.error("\uD83D\uDEA8 Fatal error:",s),process.exit(1)}}p();
