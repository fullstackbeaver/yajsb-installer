// @bun
import{mkdir as T,readdir as V,rename as W,stat as X}from"fs/promises";import Z from"os";import M from"path";var y="\x1B[32m",B="\x1B[0m",Q="./node_modules/yajsb/lib",S=Z.platform().startsWith("win")?"move":"mv";async function H(q,x){try{console.log(x);let w=Bun.spawn(q.split(" "),{stdout:"pipe",stderr:"pipe"}),A=w.stdout?await new Response(w.stdout).text():"",z=w.stderr?await new Response(w.stderr).text():"";if(await w.exited!==0)console.error(`\u274C Command failed: ${q}`),console.error(`stdout: ${A}`),console.error(`stderr: ${z}`),process.exit(1)}catch(w){console.error("\uD83D\uDEA8 Erreur critique:",w),process.exit(1)}}function Y(q){let x=process.stdin;return process.stdout.write(q),new Promise((A)=>{x.resume(),x.once("data",(z)=>{A(z.toString().trim())})})}async function U(q,x){await T(x,{recursive:!0});let w=await V(q);for(let A of w){let z=M.join(q,A),K=M.join(x,A);if((await X(z)).isDirectory())await U(z,K);else await W(z,K)}}async function G(){try{await H("bun init","\uD83D\uDCE6 Project instantiation..."),await H("bun add github:fullstackbeaver/yajsb","\uD83D\uDCE6 Installing Yajsb..."),console.log("\uD83D\uDCE6 Ajout des scripts...");let q=await Bun.file("./package.json").json();q.scripts={...q.scripts,start:"bun --watch run index.ts --verbose",updateComponentsList:"bun run scripts.ts types",updateComponentsScssList:"bun run scripts.ts scss"},await Bun.write("./package.json",JSON.stringify(q,null,2)),await H(`${S} ${Q}/scripts.ts ./scripts.ts`,"\uD83D\uDCE6 Adding scripts"),await H(`${S} ${Q}/templates ./templates`,"\uD83D\uDCE6 Adding templates..."),await T("./site",{recursive:!0}),console.log(`${y}Do you need a demo site?${B}`),console.log("(y) yes"),console.log("(n) no");let w=await Y("Select an option (default is yes):")==="n"?"yajsb-empty-site":"yajsb-site-demo";await H(`bun add github:fullstackbeaver/${w} -D`,"\uD83D\uDCE6 Installation of the sample site or empty site..."),await U(`./node_modules/${w}`,"./site"),await H("rm ./installer.js","\uD83D\uDCE6 Removing installer..."),process.exit(0)}catch(q){console.error("\uD83D\uDEA8 Fatal error:",q),process.exit(1)}}G();
